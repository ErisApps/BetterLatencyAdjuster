using BeatSaberMarkupLanguage.Attributes;
using System.Timers;
using System.Threading.Tasks;
using TMPro;
using UnityEngine;

namespace BetterLatencyAdjuster.UI
{
    class SettingsViewController : PersistentSingleton<SettingsViewController>
    {
        private readonly byte[] WHITE_IMAGE = System.Convert.FromBase64String("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AYht+mSkUqHewgIpihOlkQLeIoVSyChdJWaNXB5NI/aNKQpLg4Cq4FB38Wqw4uzro6uAqC4A+Ii6uToouU+F1SaBHjwd09vPe9L3ffAUKzylSzZxJQNctIJ+JiLr8qBl4RxChCtMYkZurJzGIWnuPrHj6+30V5lnfdn2NAKZgM8InEc0w3LOIN4plNS+e8TxxmZUkhPieeMOiCxI9cl11+41xyWOCZYSObnicOE4ulLpa7mJUNlThGHFFUjfKFnMsK5y3OarXO2vfkLwwWtJUM12mOIIElJJGCCBl1VFCFhSjtGikm0nQe9/APO/4UuWRyVcDIsYAaVEiOH/wPfvfWLE5PuUnBOND7YtsfY0BgF2g1bPv72LZbJ4D/GbjSOv5aE5j9JL3R0SJHQGgbuLjuaPIecLkDDD3pkiE5kp+mUCwC72f0TXlg8BboX3P71j7H6QOQpV4t3wAHh8B4ibLXPd7d1923f2va/fsBuKlyw7LqvioAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfjDB8PFjs3QXKKAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAAxJREFUCNdj+P//PwAF/gL+3MxZ5wAAAABJRU5ErkJggg==");
        private readonly byte[] BLACK_IMAGE = System.Convert.FromBase64String("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AYht+mSkUqHewgIpihOlkQLeIoVSyChdJWaNXB5NI/aNKQpLg4Cq4FB38Wqw4uzro6uAqC4A+Ii6uToouU+F1SaBHjwd09vPe9L3ffAUKzylSzZxJQNctIJ+JiLr8qBl4RxChCtMYkZurJzGIWnuPrHj6+30V5lnfdn2NAKZgM8InEc0w3LOIN4plNS+e8TxxmZUkhPieeMOiCxI9cl11+41xyWOCZYSObnicOE4ulLpa7mJUNlThGHFFUjfKFnMsK5y3OarXO2vfkLwwWtJUM12mOIIElJJGCCBl1VFCFhSjtGikm0nQe9/APO/4UuWRyVcDIsYAaVEiOH/wPfvfWLE5PuUnBOND7YtsfY0BgF2g1bPv72LZbJ4D/GbjSOv5aE5j9JL3R0SJHQGgbuLjuaPIecLkDDD3pkiE5kp+mUCwC72f0TXlg8BboX3P71j7H6QOQpV4t3wAHh8B4ibLXPd7d1923f2va/fsBuKlyw7LqvioAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfjDB8PDRLcxSF8AAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAAxJREFUCNdjYGBgAAAABAABJzQnCgAAAABJRU5ErkJggg==");
        private readonly byte[] AUDIO = System.Convert.FromBase64String("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");
        private const int interval = 200;
        private Texture2D blackTexture = new Texture2D(1, 1);
        private Texture2D whiteTexture = new Texture2D(1, 1); 
        private int currentInterval = interval;
        private const int soundInterval = 10;

        [UIComponent("flashImage")]
        private UnityEngine.UI.RawImage _flashImage;

        [UIComponent("countdownText")]
        private TextMeshProUGUI _countDownText;

        private AudioSource audio;
        [UIAction("#post-parse")]
        internal void Setup()
        {
            _flashImage.texture = blackTexture;
            blackTexture.LoadImage(BLACK_IMAGE);
            whiteTexture.LoadImage(WHITE_IMAGE);
            audio = _countDownText.gameObject.AddComponent<AudioSource>() as AudioSource;
            float[] audioFloat = new float[AUDIO.Length/4];
            for (int i = 0; i < AUDIO.Length; i += 4)
                audioFloat[i/4] = System.BitConverter.ToSingle(AUDIO, i);
            AudioClip clip = AudioClip.Create("hitsound", audioFloat.Length, 1, 44100, false);
            clip.SetData(audioFloat, 0);
            audio.clip = clip;
            //Logger.log.Critical(audioFloat.Length + "");
            Timer timer = new Timer(10);
            timer.Elapsed += async (sender, e) => await FlashImage();
            timer.Start();
        }

        private async Task FlashImage()
        {
            await Task.Run(() =>
            {
                currentInterval -= 1;
                _countDownText.text = "" + currentInterval;
                if (currentInterval == 0)
                {
                    _flashImage.texture = whiteTexture;
                    audio.Play();
                }
                else if(currentInterval == -soundInterval)
                {
                    currentInterval = interval;
                    _flashImage.texture = blackTexture;
                }
            });
        }
    }
}